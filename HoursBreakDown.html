<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1187.39">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0rc2/sdk-debug.js"&gt;&lt;/script&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;p id="value"&gt;&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script type="text/javascript" src="/apps/1.26/sdk.js?debug=true"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script type="text/javascript"&gt;</p>
<p class="p1"><span class="Apple-converted-space">       </span>rally.addOnLoad(</p>
<p class="p1"><span class="Apple-converted-space">           </span>function mainfunc() {</p>
<p class="p1"><span class="Apple-converted-space">              </span>console.log("\n\n\n\nThis is the start\n\n\n");</p>
<p class="p1"><span class="Apple-converted-space">              </span>var rallyDataSource = new rally.sdk.data.RallyDataSource("__WORKSPACE_OID__",</p>
<p class="p1"><span class="Apple-converted-space">                                                                      </span>"__PROJECT_OID__",</p>
<p class="p1"><span class="Apple-converted-space">                                                                      </span>"__PROJECT_SCOPING_UP__",</p>
<p class="p1"><span class="Apple-converted-space">                                                                      </span>"__PROJECT_SCOPING_DOWN__");</p>
<p class="p2"><span class="Apple-converted-space">              </span></p>
<p class="p1"><span class="Apple-converted-space">              </span>var commitToDoDev = 0;</p>
<p class="p1"><span class="Apple-converted-space">              </span>var commitToDoQa = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>/* Function to get the committed Stories from the iteration */</p>
<p class="p1"><span class="Apple-converted-space">              </span>function getCommittedStories(){</p>
<p class="p1"><span class="Apple-converted-space">                 </span>var query = '(((Iteration.StartDate &lt;= today) AND (Iteration.EndDate &gt;= today)) AND (StoryState = "Commit"))';</p>
<p class="p1"><span class="Apple-converted-space">                 </span>var fetchValues = 'Name,ObjectID,Owner,PlanEstimate,RiskofCarryOver,ScheduleState,StoryState,TaskEstimateTotal,TaskRemainingTotal,Tasks'</p>
<p class="p1"><span class="Apple-converted-space">                 </span>var queryObj = {key: "stories",</p>
<p class="p1"><span class="Apple-converted-space">                                 </span>type: "hierarchicalrequirement",</p>
<p class="p1"><span class="Apple-converted-space">                                 </span>query: query,</p>
<p class="p1"><span class="Apple-converted-space">                                 </span>fetch: fetchValues</p>
<p class="p1"><span class="Apple-converted-space">                                 </span>};</p>
<p class="p2"><span class="Apple-converted-space">   </span></p>
<p class="p1"><span class="Apple-converted-space">                 </span>rallyDataSource.findAll(queryObj, haveStoriesGetTasks, noStoriesError);</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>/* Function to iterate through all the stories and find their tasks */</p>
<p class="p1"><span class="Apple-converted-space">              </span>function haveStoriesGetTasks(results) {</p>
<p class="p1"><span class="Apple-converted-space">                 </span>for(var i = 0; i &lt; results.stories.length; i++) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>var aStory = results.stories[i];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>var storyTasks = aStory.Tasks;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>for (var j = 0 ; j &lt; storyTasks.length ; j++){</p>
<p class="p1"><span class="Apple-converted-space">                       </span>var aTask = storyTasks[j];</p>
<p class="p1"><span class="Apple-converted-space">                       </span>getTaskInfo(aTask.ObjectID);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                 </span>}</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p2"><span class="Apple-converted-space">              </span></p>
<p class="p1"><span class="Apple-converted-space">              </span>/* Function to get the information for a given task */</p>
<p class="p1"><span class="Apple-converted-space">              </span>function getTaskInfo(taskId){</p>
<p class="p1"><span class="Apple-converted-space">                 </span>var queryTask = '(ObjectID = ' + taskId + ')';</p>
<p class="p1"><span class="Apple-converted-space">                 </span>var fetchTask = 'Actuals,Estimate,Name,ObjectID,Owner,State,TaskType,ToDo';</p>
<p class="p1"><span class="Apple-converted-space">                 </span>var queryTask = {key: "tasks",</p>
<p class="p1"><span class="Apple-converted-space">                                  </span>type: "Tasks",</p>
<p class="p1"><span class="Apple-converted-space">                                  </span>query: queryTask,</p>
<p class="p1"><span class="Apple-converted-space">                                  </span>fetch: fetchTask</p>
<p class="p1"><span class="Apple-converted-space">                                  </span>};</p>
<p class="p1"><span class="Apple-converted-space">                 </span>rallyDataSource.findAll(queryTask, haveTaskCalculateHours, noTasksError);</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>/* Function to calculate the hours from the task information */</p>
<p class="p1"><span class="Apple-converted-space">              </span>function haveTaskCalculateHours(results){</p>
<p class="p1"><span class="Apple-converted-space">                 </span>var foundTasks = results.tasks;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>var aTask = foundTasks[0];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                 </span>if (aTask.TaskType == "Dev"){</p>
<p class="p1"><span class="Apple-converted-space">                    </span>commitToDoDev += aTask.ToDo;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>}</p>
<p class="p1"><span class="Apple-converted-space">                 </span>else if (aTask.TaskType == "QA"){</p>
<p class="p1"><span class="Apple-converted-space">                    </span>commitToDoQa += aTask.ToDo;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>}</p>
<p class="p1"><span class="Apple-converted-space">                 </span>console.log(aTask.TaskType + "-" + commitToDoDev + "-" + commitToDoQa);</p>
<p class="p1"><span class="Apple-converted-space">                 </span>updateDisplay();</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>/* Error function when stories could not be retrieved */</p>
<p class="p1"><span class="Apple-converted-space">              </span>function noStoriesError(response){</p>
<p class="p1"><span class="Apple-converted-space">                 </span>console.log("I got here noStoriesError 1");</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>/* Error function when task information could not be retrieved */</p>
<p class="p1"><span class="Apple-converted-space">              </span>function noTasksError(response){</p>
<p class="p1"><span class="Apple-converted-space">                 </span>console.log("I got here noTasksError 1");</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>/* Function to update the display on screen */</p>
<p class="p1"><span class="Apple-converted-space">              </span>function updateDisplay(){</p>
<p class="p1"><span class="Apple-converted-space">                 </span>var toDisplay = "Committed Dev-QA hours = " + commitToDoDev + "-" + commitToDoQa;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>document.getElementById("value").innerHTML = toDisplay;</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>/* code start ! */</p>
<p class="p1"><span class="Apple-converted-space">              </span>getCommittedStories();</p>
<p class="p1"><span class="Apple-converted-space">           </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
